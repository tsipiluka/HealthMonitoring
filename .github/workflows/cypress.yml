name: E2E on Chrome
on: [push]
jobs:
  cypress-run:
    runs-on: ubuntu-20.04
    # let's make sure our tests pass on Chrome browser
    name: E2E on Chrome
    steps:
      - uses: actions/checkout@v2
        with:
          ref: ${{ github.head_ref }}
      - uses: bahmutov/npm-install@v1
        with:
          working-directory: frontend/healthmonitoring
          install-command: npm i --force
      # - name: Start Frontend
      #   with:
      #     working-directory: frontend/healthmonitoring
      #   run: ng serve &
      # - name: Start backend
      #   uses: brettcannon/pip-secure-install@v1.0.0
      #   with:
      #     working-directory: backend
      #   run: |
      #     pip install -r requirements.txt
      #     python manage.py runserver &
      #     # python manage.py createpatient pat1@pat.de Tester123321+ Pat Pat
      - name: Start app
        run: |
          docker-compose up -d
      - uses: cypress-io/github-action@v4
        with:
          wait-on: 'http://127.0.0.1:4200 , http://127.0.0.1:8000'
          browser: chrome
          working-directory: frontend/healthmonitoring/cypress/e2e
          project: frontend/healthmonitoring/
          # config-file: ./frontend/healthmonitoring/cypress.config.ts
        env: 
          CYPRESS_host: "127.0.0.1"
          CYPRESS_port: 4200
